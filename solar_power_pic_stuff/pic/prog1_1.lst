MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001         LIST p=16f877a ; Include file, change directory if needed
                      00002         INCLUDE "p16f877a.inc"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F877A processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2011 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00555         LIST
                      00003 
                      00004         CBLOCK 0x20
  00000020            00005         mac_dest_1
  00000021            00006         mac_dest_2
  00000022            00007         mac_dest_3
  00000023            00008         mac_dest_4
  00000024            00009         mac_dest_5
  00000025            00010         mac_dest_6
  00000026            00011         mac_src_1
  00000027            00012         mac_src_2
  00000028            00013         mac_src_3
  00000029            00014         mac_src_4
  0000002A            00015         mac_src_5
  0000002B            00016         mac_src_6
  0000002C            00017         mac_type_1
  0000002D            00018         mac_type_2 ; 14 bytes
                      00019 
  0000002E            00020         ip_version_and_header_length
  0000002F            00021         ip_dummy
  00000030            00022         ip_length_1
  00000031            00023         ip_length_2
  00000032            00024         ip_packet_id_1
  00000033            00025         ip_packet_id_2
  00000034            00026         ip_flags_1
  00000035            00027         ip_flags_2
  00000036            00028         ip_ttl
  00000037            00029         ip_protocol
  00000038            00030         ip_header_checksum_1
  00000039            00031         ip_header_checksum_2
  0000003A            00032         ip_src_1
  0000003B            00033         ip_src_2
  0000003C            00034         ip_src_3
  0000003D            00035         ip_src_4
  0000003E            00036         ip_dest_1
  0000003F            00037         ip_dest_2
  00000040            00038         ip_dest_3
  00000041            00039         ip_dest_4 ; 20 bytes (34 bytes total)
                      00040 
  00000042            00041         udp_src_port_1
  00000043            00042         udp_src_port_2
  00000044            00043         udp_dest_port_1
  00000045            00044         udp_dest_port_2
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000046            00045         udp_length_1
  00000047            00046         udp_length_2
  00000048            00047         udp_checksum_1
  00000049            00048         udp_checksum_2 ; 8 bytes (42 bytes total)
                      00049 
  0000004A            00050         magic ; always 0xAB
  0000004B            00051         version
  0000004C            00052         eee
  0000004D            00053         sleep_1
  0000004E            00054         sleep_2
                      00055 
  0000004F            00056         spi_device_id
  00000050            00057         spi_out_length
  00000051            00058         spi_out_pointer
  00000052            00059         spi_out_1
  00000053            00060         spi_out_2
  00000054            00061         spi_out_3
  00000055            00062         spi_out_4
  00000056            00063         spi_out_5
  00000057            00064         spi_out_6
  00000058            00065         spi_out_7
  00000059            00066         spi_out_8
  0000005A            00067         spi_memory_dump
                      00068 
                      00069         ENDC
                      00070 
0000                  00071         ORG 0x000 ; start at the reset vector
0000   0000           00072         nop
                      00073 
0001   2952           00074         GOTO main ; start the program
                      00075 
0002                  00076 wait
0002   30FF           00077         MOVLW 0xFF
0003   00CE           00078         MOVWF sleep_2
0004   30FF           00079         MOVLW 0xFF
0005   00CD           00080         MOVWF sleep_1
0006                  00081 wloop
0006   0BCD           00082         DECFSZ sleep_1, F
0007   2806           00083         GOTO wloop
0008   0BCE           00084         DECFSZ sleep_2, F
0009   2806           00085         GOTO wloop
000A   0008           00086         RETURN
                      00087 
                      00088 ;d wait3
                      00089 ;d      CALL wait
                      00090 ;d      CALL wait
                      00091 ;d      CALL wait
                      00092 ;d      RETURN
                      00093 
                      00094 ;d wait4
                      00095 ;d      CALL wait3
                      00096 ;d      CALL wait3
                      00097 ;d      CALL wait3
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00098 ;d      RETURN
                      00099 
000B                  00100 init_vars
000B   30F4           00101         MOVLW 0xf4
000C   00A0           00102         MOVWF mac_dest_1
000D   306D           00103         MOVLW 0x6d
000E   00A1           00104         MOVWF mac_dest_2
000F   3004           00105         MOVLW 0x04
0010   00A2           00106         MOVWF mac_dest_3
0011   30E7           00107         MOVLW 0xe7
0012   00A3           00108         MOVWF mac_dest_4
0013   30B2           00109         MOVLW 0xb2
0014   00A4           00110         MOVWF mac_dest_5
0015   3034           00111         MOVLW 0x34
0016   00A5           00112         MOVWF mac_dest_6
0017   30E0           00113         MOVLW 0xE0
0018   00A6           00114         MOVWF mac_src_1
0019   30CB           00115         MOVLW 0xCB
001A   00A7           00116         MOVWF mac_src_2
001B   304E           00117         MOVLW 0x4E
001C   00A8           00118         MOVWF mac_src_3
001D   305E           00119         MOVLW 0x5E
001E   00A9           00120         MOVWF mac_src_4    ; <<<
001F   3087           00121         MOVLW 0x87
0020   00AA           00122         MOVWF mac_src_5    ; <<<
0021   308E           00123         MOVLW 0x8E
0022   00AB           00124         MOVWF mac_src_6    ; <<<
0023   3008           00125         MOVLW 0x08
0024   00AC           00126         MOVWF mac_type_1
0025   3000           00127         MOVLW 0x00
0026   00AD           00128         MOVWF mac_type_2
                      00129 
0027   3045           00130         MOVLW 0x45
0028   00AE           00131         MOVWF ip_version_and_header_length
0029   3000           00132         MOVLW 0x00
002A   00AF           00133         MOVWF ip_dummy
002B   3000           00134         MOVLW 0x00
002C   00B0           00135         MOVWF ip_length_1    ; <<<
002D   3052           00136         MOVLW 0x52
002E   00B1           00137         MOVWF ip_length_2    ; <<< (including IP and UDP header)
002F   3000           00138         MOVLW 0x00
0030   00B2           00139         MOVWF ip_packet_id_1 ; <<<
0031   3000           00140         MOVLW 0x00
0032   00B3           00141         MOVWF ip_packet_id_2 ; <<< increment this before transmit
0033   3040           00142         MOVLW 0x40
0034   00B4           00143         MOVWF ip_flags_1
0035   3000           00144         MOVLW 0x00
0036   00B5           00145         MOVWF ip_flags_2
0037   3040           00146         MOVLW 0x40
0038   00B6           00147         MOVWF ip_ttl
0039   3011           00148         MOVLW 0x11
003A   00B7           00149         MOVWF ip_protocol
003B   30B8           00150         MOVLW 0xB8
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

003C   00B8           00151         MOVWF ip_header_checksum_1    ; <<<
003D   3075           00152         MOVLW 0x75
003E   00B9           00153         MOVWF ip_header_checksum_2    ; <<<
003F   30C0           00154         MOVLW 0xC0
0040   00BA           00155         MOVWF ip_src_1
0041   30A8           00156         MOVLW 0xA8
0042   00BB           00157         MOVWF ip_src_2
0043   3000           00158         MOVLW 0x00
0044   00BC           00159         MOVWF ip_src_3
0045   30C9           00160         MOVLW 0xC9
0046   00BD           00161         MOVWF ip_src_4
0047   30C0           00162         MOVLW 0xC0
0048   00BE           00163         MOVWF ip_dest_1
0049   30A8           00164         MOVLW 0xA8
004A   00BF           00165         MOVWF ip_dest_2
004B   3000           00166         MOVLW 0x00
004C   00C0           00167         MOVWF ip_dest_3
004D   300C           00168         MOVLW 0x0C
004E   00C1           00169         MOVWF ip_dest_4
                      00170 
004F   3018           00171         MOVLW 0x18
0050   00C2           00172         MOVWF udp_src_port_1
0051   30F7           00173         MOVLW 0xF7
0052   00C3           00174         MOVWF udp_src_port_2
0053   3018           00175         MOVLW 0x18
0054   00C4           00176         MOVWF udp_dest_port_1
0055   30F8           00177         MOVLW 0xF8
0056   00C5           00178         MOVWF udp_dest_port_2
0057   3000           00179         MOVLW 0x00
0058   00C6           00180         MOVWF udp_length_1    ; <<<
0059   3009           00181         MOVLW 0x09
005A   00C7           00182         MOVWF udp_length_2    ; <<< (including UDP header)
005B   3000           00183         MOVLW 0x00           
005C   00C8           00184         MOVWF udp_checksum_1  ; ignore
005D   3000           00185         MOVLW 0x00
005E   00C9           00186         MOVWF udp_checksum_2  ; ignore
                      00187 
005F   3065           00188         MOVLW 0x65 ; "e"
0060   00CA           00189         MOVWF magic
                      00190 
0061   3001           00191         MOVLW 0x01
0062   00CB           00192         MOVWF version
0063   0008           00193         RETURN
                      00194 
0064                  00195 spi_init
0064   1283 1303      00196         BANKSEL PORTA ; BANK0
0066   1408           00197         BSF PORTD, 0
                      00198 
0067   1683 1303      00199         BANKSEL TRISA ; BANK1
0069   3040           00200         MOVLW 0x40
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
006A   0094           00201         MOVWF SSPSTAT
006B   1283 1303      00202         BANKSEL PORTA ; BANK0
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

006D   3020           00203         MOVLW 0x20
006E   0094           00204         MOVWF SSPCON
                      00205 
006F   3000           00206         MOVLW 0x00
0070   00DA           00207         MOVWF spi_memory_dump ; disable memory dump on next packet
                      00208 
0071   0008           00209         RETURN
                      00210 
0072                  00211 spi_send
                      00212         ;; select device
0072   1283 1303      00213         BANKSEL PORTA ; BANK0
0074   1008           00214         BCF PORTD, 0
                      00215 
                      00216         ;; send the bytes
0075   3052           00217         MOVLW spi_out_1           ; seek to the first byte
0076   0084           00218         MOVWF FSR                 ; our pointer is "file select register"
0077                  00219 spi_send_loop
0077   1394           00220         BCF SSPCON, 7             ; WCOL
0078   0800           00221         MOVF INDF, W              ; load the byte
0079   0093           00222         MOVWF SSPBUF              ; send the byte
                      00223 ;d      MOVF FSR, W
                      00224 ;d      MOVWF PORTB
                      00225 ;d      CALL wait3
007A   1683 1303      00226         BANKSEL TRISA ; BANK1
007C                  00227 spi_send_wait
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
007C   1C14           00228         BTFSS SSPSTAT, BF
007D   287C           00229         GOTO spi_send_wait
007E   1283 1303      00230         BANKSEL PORTA ; BANK0
0080   0A84           00231         INCF FSR, F               ; increase the pointer
0081   0BD0           00232         DECFSZ spi_out_length, F  ; decrease the remaining byte counter
0082   2877           00233         GOTO spi_send_loop        ; go back if we have more bytes
                      00234 
                      00235         ; ;;;; memory dump option!
0083   1C5A           00236         BTFSS spi_memory_dump, 0
0084   288B           00237         GOTO spi_no_dump
0085   105A           00238         BCF spi_memory_dump, 0     ; disable further memory dumps (endless loop)
0086   3020           00239         MOVLW 0x20                 ; set the pointer to the first byte
0087   0084           00240         MOVWF FSR
0088   3060           00241         MOVLW 0x60                 ; whole BANK0 "General Purpose Registry" memory
0089   00D0           00242         MOVWF spi_out_length
                      00243 ;d      CALL led_blue_on
008A   2877           00244         GOTO spi_send_loop
                      00245 
008B                  00246 spi_no_dump
                      00247 ;d      CALL led_blue_off
                      00248 ;d      MOVLW 0x00
                      00249 ;d      MOVWF PORTB
                      00250 
                      00251         ;; deselect device
008B   1408           00252         BSF PORTD, 0
                      00253 ;d      CALL wait4
                      00254         
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

008C   0008           00255         RETURN
                      00256 
                      00257 
008D                  00258 eth_init
008D   3001           00259         MOVLW 0x01 ; = eth
008E   00CF           00260         MOVWF spi_device_id
                      00261         
008F   2002           00262         CALL wait
0090   2002           00263         CALL wait
0091   2002           00264         CALL wait
                      00265         ;; eth: system reset (see doc 6.0)
0092   30FF           00266         MOVLW 0xFF ; SC (reset)
0093   00D2           00267         MOVWF spi_out_1
                      00268 
0094   3001           00269         MOVLW 0x01 ; spi: how many byte outputs follow
0095   00D0           00270         MOVWF spi_out_length
0096   2072           00271         CALL spi_send
                      00272 
0097   2002           00273         CALL wait
0098   2002           00274         CALL wait
0099   2002           00275         CALL wait
                      00276 
                      00277 
                      00278         ;; eth: select BANK0
009A   30A0           00279         MOVLW 0xA0 ; BFC
009B   381F           00280         IORLW 0x1F ; ECON1 (1F)
009C   00D2           00281         MOVWF spi_out_1
009D   3003           00282         MOVLW 0x03 ; xxxxxx00
009E   00D3           00283         MOVWF spi_out_2
                      00284 
009F   3002           00285         MOVLW 0x02 ; spi: how many byte outputs follow
00A0   00D0           00286         MOVWF spi_out_length
00A1   2072           00287         CALL spi_send
                      00288 
                      00289 
                      00290         ;; eth: set receive buffer start and end pointers (see doc 6.1)
00A2   3040           00291         MOVLW 0x40 ; WCR
00A3   3808           00292         IORLW 0x08 ; ERXSTL
00A4   00D2           00293         MOVWF spi_out_1
00A5   3000           00294         MOVLW 0x00 ; ... ERXSTL
00A6   00D3           00295         MOVWF spi_out_2
00A7   3000           00296         MOVLW 0x00 ; ... ERXSTH
00A8   00D4           00297         MOVWF spi_out_3
00A9   30FF           00298         MOVLW 0xFF ; ... ERXNDL
00AA   00D5           00299         MOVWF spi_out_4
00AB   300F           00300         MOVLW 0x0F ; ... ERXNDH
00AC   00D6           00301         MOVWF spi_out_5
                      00302         
00AD   3005           00303         MOVLW 0x05 ;; spi: how many byte outputs follow
00AE   00D0           00304         MOVWF spi_out_length
00AF   2072           00305         CALL spi_send
                      00306 
                      00307 ;optimization...
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00308 ;       ;; eth: select BANK2
                      00309 ;       MOVLW 0xA0 ; BFC
                      00310 ;       IORLW 0x1F ; ECON1 (1F)
                      00311 ;       MOVWF spi_out_1
                      00312 ;       MOVLW 0x03 ; xxxxxx00
                      00313 ;       MOVWF spi_out_2
                      00314 ;
                      00315 ;       MOVLW 0x02 ; spi: how many byte outputs follow
                      00316 ;       MOVWF spi_out_length
                      00317 ;       CALL spi_send
                      00318 
00B0   3080           00319         MOVLW 0x80 ; BFS
00B1   381F           00320         IORLW 0x1F ; ECON1
00B2   00D2           00321         MOVWF spi_out_1
00B3   3002           00322         MOVLW 0x02 ; xxxxxx1x => xxxxxx10
00B4   00D3           00323         MOVWF spi_out_2
                      00324 
00B5   3002           00325         MOVLW 0x02 ; spi: how many byte outputs follow
00B6   00D0           00326         MOVWF spi_out_length
00B7   2072           00327         CALL spi_send
                      00328 
                      00329 
                      00330         ;; init MAC parameters (see doc 6.5)
00B8   3040           00331         MOVLW 0x40 ; WCR
00B9   3800           00332         IORLW 0x00 ; MACON1 (00)
00BA   00D2           00333         MOVWF spi_out_1
00BB   300D           00334         MOVLW 0x0D ; ... MACON1
00BC   00D3           00335         MOVWF spi_out_2
00BD   3000           00336         MOVLW 0x00 ; ... MACON2
00BE   00D4           00337         MOVWF spi_out_3
00BF   3077           00338         MOVLW 0x77 ; ... MACON3
00C0   00D5           00339         MOVWF spi_out_4
00C1   3003           00340         MOVLW 0x03 ; ... MACON4
00C2   00D6           00341         MOVWF spi_out_5
00C3   300F           00342         MOVLW 0x0F ; ... MABBIPG
00C4   00D7           00343         MOVWF spi_out_6
                      00344         
00C5   3006           00345         MOVLW 0x06 ;; spi: how many byte outputs follow
00C6   00D0           00346         MOVWF spi_out_length
00C7   2072           00347         CALL spi_send
                      00348 
                      00349         
                      00350         ;; init LEDs by writing the PHLCON register indirectly (see doc 2.6 and 3.3.2)
00C8   3040           00351         MOVLW 0x40 ; WCR
00C9   3814           00352         IORLW 0x14 ; MIREGADR (14)
00CA   00D2           00353         MOVWF spi_out_1
00CB   3014           00354         MOVLW 0x14 ; ... MIREGADR (14 = eth PHLCON)
00CC   00D3           00355         MOVWF spi_out_2
00CD   3000           00356         MOVLW 0x00 ; ... -
00CE   00D4           00357         MOVWF spi_out_3
00CF   3072           00358         MOVLW 0x72 ; ... MIWRL
00D0   00D5           00359         MOVWF spi_out_4
00D1   3004           00360         MOVLW 0x04 ; ... MIWRH
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D2   00D6           00361         MOVWF spi_out_5
                      00362         
00D3   3005           00363         MOVLW 0x05 ;; spi: how many byte outputs follow
00D4   00D0           00364         MOVWF spi_out_length
00D5   2072           00365         CALL spi_send
                      00366 
00D6   0008           00367         RETURN
                      00368 
                      00369 ;;; test function to turn on both LEDs on eth
                      00370 ;eth_leds_on
                      00371 ;       BANKSEL PORTA ; BANK0
                      00372 ;
                      00373 ;       MOVLW 0x01 ; = eth
                      00374 ;       MOVWF spi_device_id
                      00375 ;
                      00376 ;       ;; eth select BANK2
                      00377 ;       MOVLW 0xA0 ; BFC
                      00378 ;       IORLW 0x1F ; ECON1 (1F)
                      00379 ;       MOVWF spi_out_1
                      00380 ;       MOVLW 0x03
                      00381 ;       MOVWF spi_out_2
                      00382 ;
                      00383 ;       MOVLW 0x02 ; spi: how many byte outputs follow
                      00384 ;       MOVWF spi_out_length
                      00385 ;       CALL spi_send
                      00386 ;
                      00387 ;       MOVLW 0x80 ; BFS
                      00388 ;       IORLW 0x1F ; ECON1 (1F)
                      00389 ;       MOVWF spi_out_1
                      00390 ;       MOVLW 0x02
                      00391 ;       MOVWF spi_out_2
                      00392 ;
                      00393 ;       MOVLW 0x02 ; spi: how many byte outputs follow
                      00394 ;       MOVWF spi_out_length
                      00395 ;       CALL spi_send
                      00396 ;
                      00397 ;
                      00398 ;       MOVLW 0x40 ; WCR
                      00399 ;       IORLW 0x14 ; MIREGADR (14)
                      00400 ;       MOVWF spi_out_1
                      00401 ;       MOVLW 0x14 ; ... MIREGADR (14 = eth PHLCON)
                      00402 ;       MOVWF spi_out_2
                      00403 ;       MOVLW 0x00 ; ... -
                      00404 ;       MOVWF spi_out_3
                      00405 ;       MOVLW 0x82 ; ... MIWRL
                      00406 ;       MOVWF spi_out_4
                      00407 ;       MOVLW 0x08 ; ... MIWRH
                      00408 ;       MOVWF spi_out_5
                      00409 ;       
                      00410 ;       MOVLW 0x05 ;; spi: how many byte outputs follow
                      00411 ;       MOVWF spi_out_length
                      00412 ;       CALL spi_send
                      00413 ;
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00414 ;       RETURN
                      00415 
00D7                  00416 eth_send_packet
00D7   1283 1303      00417         BANKSEL PORTA ; BANK0
                      00418 
                      00419         ;; eth: select BANK0
00D9   30A0           00420         MOVLW 0xA0 ; BFC
00DA   381F           00421         IORLW 0x1F ; ECON1 (1F)
00DB   00D2           00422         MOVWF spi_out_1
00DC   3003           00423         MOVLW 0x03 ; xxxxxx00
00DD   00D3           00424         MOVWF spi_out_2
                      00425 
00DE   3002           00426         MOVLW 0x02 ; spi: how many byte outputs follow
00DF   00D0           00427         MOVWF spi_out_length
00E0   2072           00428         CALL spi_send
                      00429 
                      00430 
                      00431         ;; eth: set up ETXST (see doc 7.1.1)
00E1   3040           00432         MOVLW 0x40 ; WCR
00E2   3804           00433         IORLW 0x04 ; ETXSTL
00E3   00D2           00434         MOVWF spi_out_1
00E4   3000           00435         MOVLW 0x00 ; ... ETXSTL
00E5   00D3           00436         MOVWF spi_out_2
00E6   3010           00437         MOVLW 0x10 ; ... ETXSTH
00E7   00D4           00438         MOVWF spi_out_3
                      00439         
00E8   3003           00440         MOVLW 0x03 ;; spi: how many byte outputs follow
00E9   00D0           00441         MOVWF spi_out_length
00EA   2072           00442         CALL spi_send
                      00443 
                      00444 
                      00445         ;; eth: set up EWRPT (see doc 7.1.1)
00EB   3040           00446         MOVLW 0x40 ; WCR
00EC   3802           00447         IORLW 0x02 ; EWRPTL
00ED   00D2           00448         MOVWF spi_out_1
00EE   3000           00449         MOVLW 0x00 ; ... EWRPTL
00EF   00D3           00450         MOVWF spi_out_2
00F0   3010           00451         MOVLW 0x10 ; ... EWRPTH
00F1   00D4           00452         MOVWF spi_out_3
                      00453         
00F2   3003           00454         MOVLW 0x03 ;; spi: how many byte outputs follow
00F3   00D0           00455         MOVWF spi_out_length
00F4   2072           00456         CALL spi_send
                      00457 
                      00458 
                      00459         ;; eth: send the "per packet control byte" and the data payload (see doc 7.1.2)
                      00460         ;;      the payload is actually the whole memory :)
00F5   3060           00461         MOVLW 0x60 ; WBM
00F6   381A           00462         IORLW 0x1A ; required argument
00F7   00D2           00463         MOVWF spi_out_1
00F8   3000           00464         MOVLW 0x00 ; the "per packet control byte"
00F9   00D3           00465         MOVWF spi_out_2
                      00466         
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00FA   145A           00467         BSF spi_memory_dump, 0 ; enable memory dump with next spi_send
                      00468 
00FB   3002           00469         MOVLW 0x02 ;; spi: how many byte outputs follow (before the memory dump)
00FC   00D0           00470         MOVWF spi_out_length
00FD   2072           00471         CALL spi_send
                      00472         
                      00473 
                      00474         ;; eth: set up ETXND (see doc 7.1.3)
00FE   3040           00475         MOVLW 0x40 ; WCR
00FF   3806           00476         IORLW 0x06 ; ETXNDL
0100   00D2           00477         MOVWF spi_out_1
0101   3060           00478         MOVLW 0x60 ; ... ETXNDL
0102   00D3           00479         MOVWF spi_out_2
0103   3010           00480         MOVLW 0x10 ; ... ETXNDH
0104   00D4           00481         MOVWF spi_out_3
                      00482         
0105   3003           00483         MOVLW 0x03 ;; spi: how many byte outputs follow
0106   00D0           00484         MOVWF spi_out_length
0107   2072           00485         CALL spi_send
                      00486 
                      00487 
                      00488         ;; eth: clear EIR.TXIF (see doc 7.1.4)
0108   30A0           00489         MOVLW 0xA0 ; BFC
0109   381C           00490         IORLW 0x1C ; EIR
010A   00D2           00491         MOVWF spi_out_1
010B   3008           00492         MOVLW 0x08 ; .TXIF => 0
010C   00D3           00493         MOVWF spi_out_2
                      00494         
010D   3002           00495         MOVLW 0x02 ;; spi: how many byte outputs follow
010E   00D0           00496         MOVWF spi_out_length
010F   2072           00497         CALL spi_send
                      00498 
                      00499 
                      00500         ;; eth: set EIE.TXIE (see doc 7.1.4)
0110   3080           00501         MOVLW 0x80 ; BFS
0111   381B           00502         IORLW 0x1B ; EIE
0112   00D2           00503         MOVWF spi_out_1
0113   3080           00504         MOVLW 0x80 ; .TXIF => 0
0114   00D3           00505         MOVWF spi_out_2
                      00506         
0115   3002           00507         MOVLW 0x02 ;; spi: how many byte outputs follow
0116   00D0           00508         MOVWF spi_out_length
0117   2072           00509         CALL spi_send
                      00510 
                      00511 
                      00512         ;; eth: set ECON1.TXRTS (see doc 7.1.5)
0118   3080           00513         MOVLW 0x80 ; BFS
0119   381F           00514         IORLW 0x1F ; ECON1
011A   00D2           00515         MOVWF spi_out_1
011B   3008           00516         MOVLW 0x08 ; .TXRTS => 1
011C   00D3           00517         MOVWF spi_out_2
                      00518         
011D   3002           00519         MOVLW 0x02 ;; spi: how many outputs follow
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

011E   00D0           00520         MOVWF spi_out_length
011F   2072           00521         CALL spi_send
                      00522 
                      00523         
0120   0008           00524         RETURN
                      00525 
                      00526 
0121                  00527 init
0121   1683 1303      00528         BANKSEL TRISA  ; BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0123   0185           00529         CLRF TRISA     ; set all bits on PORTA to output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0124   0186           00530         CLRF TRISB     ; set all bits on PORTB to output
                      00531         ;;CLRF TRISC     ; set all bits on PORTC to output
0125   3010           00532         MOVLW b'00010000'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0126   0087           00533         MOVWF TRISC
                      00534         ;; CLRF TRISD     ; set all bits on PORTD to output
0127   30FE           00535         MOVLW b'11111110'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0128   0088           00536         MOVWF TRISD
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0129   0189           00537         CLRF TRISE     ; set all bits on PORTE to output
                      00538 
012A   1283 1303      00539         BANKSEL PORTA  ; BANK0
012C   0185           00540         CLRF PORTA
012D   0186           00541         CLRF PORTB
012E   0187           00542         CLRF PORTC
012F   0188           00543         CLRF PORTD
0130   0189           00544         CLRF PORTE
                      00545 
0131   213A           00546         CALL led_red_on
                      00547 
0132   200B           00548         CALL init_vars
0133   2064           00549         CALL spi_init
0134   208D           00550         CALL eth_init
                      00551 ;       CALL eth_leds_on
                      00552 
0135   213E           00553         CALL led_red_off
0136   2142           00554         CALL led_green_on
                      00555 
0137   0008           00556         RETURN
                      00557 
0138                  00558 measure_input_1
0138   0008           00559         RETURN
                      00560 
0139                  00561 measure_input_2
0139   0008           00562         RETURN
                      00563 
013A                  00564 led_red_on
013A   1283 1303      00565         BANKSEL PORTA ; BANK0
013C   1405           00566         BSF PORTA, 0
013D   0008           00567         RETURN
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00568 
013E                  00569 led_red_off
013E   1283 1303      00570         BANKSEL PORTA ; BANK0
0140   1005           00571         BCF PORTA, 0
0141   0008           00572         RETURN
                      00573 
0142                  00574 led_green_on
0142   1283 1303      00575         BANKSEL PORTA ; BANK0
0144   1505           00576         BSF PORTA, 2
0145   0008           00577         RETURN
                      00578 
0146                  00579 led_green_off
0146   1283 1303      00580         BANKSEL PORTA ; BANK0
0148   1105           00581         BCF PORTA, 2
0149   0008           00582         RETURN
                      00583 
014A                  00584 led_blue_on
014A   1283 1303      00585         BANKSEL PORTA ; BANK0
014C   1485           00586         BSF PORTA, 1
014D   0008           00587         RETURN
                      00588 
014E                  00589 led_blue_off
014E   1283 1303      00590         BANKSEL PORTA ; BANK0
0150   1085           00591         BCF PORTA, 1
0151   0008           00592         RETURN
                      00593         
0152                  00594 main
0152   2121           00595         CALL init
                      00596         
0153                  00597 loop
                      00598 
0153   2146           00599         CALL led_green_off
0154   213A           00600         CALL led_red_on
0155   2002           00601         CALL wait
0156   3000           00602         MOVLW 0x00
0157   1988           00603         BTFSC PORTD, 3
0158   30FF           00604         MOVLW 0xFF
0159   00CC           00605         MOVWF eee
015A   20D7           00606         CALL eth_send_packet
015B   213E           00607         CALL led_red_off
015C   2142           00608         CALL led_green_on
015D   2002           00609         CALL wait
015E   2002           00610         CALL wait
015F   2002           00611         CALL wait
0160   2002           00612         CALL wait
0161   2002           00613         CALL wait
0162   2002           00614         CALL wait
0163   2002           00615         CALL wait
0164   2002           00616         CALL wait
0165   2002           00617         CALL wait
0166   2002           00618         CALL wait
0167   2002           00619         CALL wait
0168   2953           00620         GOTO loop
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00621         END
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
D_A                               00000005
D_NOT_A                           00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GO_NOT_DONE                       00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
NOT_A                             00000005
NOT_ADDRESS                       00000005
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SEN                               00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_HS_OSC                           00003FFE
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001
eee                               0000004C
eth_init                          0000008D
eth_send_packet                   000000D7
init                              00000121
init_vars                         0000000B
ip_dest_1                         0000003E
ip_dest_2                         0000003F
ip_dest_3                         00000040
ip_dest_4                         00000041
ip_dummy                          0000002F
ip_flags_1                        00000034
ip_flags_2                        00000035
ip_header_checksum_1              00000038
ip_header_checksum_2              00000039
ip_length_1                       00000030
ip_length_2                       00000031
ip_packet_id_1                    00000032
ip_packet_id_2                    00000033
ip_protocol                       00000037
ip_src_1                          0000003A
ip_src_2                          0000003B
ip_src_3                          0000003C
ip_src_4                          0000003D
ip_ttl                            00000036
ip_version_and_header_length      0000002E
led_blue_off                      0000014E
led_blue_on                       0000014A
led_green_off                     00000146
led_green_on                      00000142
led_red_off                       0000013E
led_red_on                        0000013A
loop                              00000153
mac_dest_1                        00000020
mac_dest_2                        00000021
mac_dest_3                        00000022
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

mac_dest_4                        00000023
mac_dest_5                        00000024
mac_dest_6                        00000025
mac_src_1                         00000026
mac_src_2                         00000027
mac_src_3                         00000028
mac_src_4                         00000029
mac_src_5                         0000002A
mac_src_6                         0000002B
mac_type_1                        0000002C
mac_type_2                        0000002D
magic                             0000004A
main                              00000152
measure_input_1                   00000138
measure_input_2                   00000139
sleep_1                           0000004D
sleep_2                           0000004E
spi_device_id                     0000004F
spi_init                          00000064
spi_memory_dump                   0000005A
spi_no_dump                       0000008B
spi_out_1                         00000052
spi_out_2                         00000053
spi_out_3                         00000054
spi_out_4                         00000055
spi_out_5                         00000056
spi_out_6                         00000057
spi_out_7                         00000058
spi_out_8                         00000059
spi_out_length                    00000050
spi_out_pointer                   00000051
spi_send                          00000072
spi_send_loop                     00000077
spi_send_wait                     0000007C
udp_checksum_1                    00000048
udp_checksum_2                    00000049
udp_dest_port_1                   00000044
udp_dest_port_2                   00000045
udp_length_1                      00000046
udp_length_2                      00000047
udp_src_port_1                    00000042
udp_src_port_2                    00000043
version                           0000004B
wait                              00000002
wloop                             00000006
MPASM  5.42                       PROG1_1.ASM   3-5-2012  20:01:38         PAGE 22


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXX------- ----------------

All other memory blocks unused.

Program Memory Words Used:   361
Program Memory Words Free:  7831


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     7 reported,     0 suppressed

