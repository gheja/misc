MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001         LIST p=16f877a ; Include file, change directory if needed
                      00002         INCLUDE "p16f877a.inc"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F877A processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2011 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00555         LIST
                      00003 
                      00004         CBLOCK 0x20
  00000020            00005         mac_dest_1
  00000021            00006         mac_dest_2
  00000022            00007         mac_dest_3
  00000023            00008         mac_dest_4
  00000024            00009         mac_dest_5
  00000025            00010         mac_dest_6
  00000026            00011         mac_src_1
  00000027            00012         mac_src_2
  00000028            00013         mac_src_3
  00000029            00014         mac_src_4
  0000002A            00015         mac_src_5
  0000002B            00016         mac_src_6
  0000002C            00017         mac_type_1
  0000002D            00018         mac_type_2 ; 14 bytes
                      00019 
  0000002E            00020         ip_version_and_header_length
  0000002F            00021         ip_dummy
  00000030            00022         ip_length_1
  00000031            00023         ip_length_2
  00000032            00024         ip_packet_id_1
  00000033            00025         ip_packet_id_2
  00000034            00026         ip_flags_1
  00000035            00027         ip_flags_2
  00000036            00028         ip_ttl
  00000037            00029         ip_protocol
  00000038            00030         ip_header_checksum_1
  00000039            00031         ip_header_checksum_2
  0000003A            00032         ip_src_1
  0000003B            00033         ip_src_2
  0000003C            00034         ip_src_3
  0000003D            00035         ip_src_4
  0000003E            00036         ip_dest_1
  0000003F            00037         ip_dest_2
  00000040            00038         ip_dest_3
  00000041            00039         ip_dest_4 ; 20 bytes (34 bytes total)
                      00040 
  00000042            00041         udp_src_port_1
  00000043            00042         udp_src_port_2
  00000044            00043         udp_dest_port_1
  00000045            00044         udp_dest_port_2
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000046            00045         udp_length_1
  00000047            00046         udp_length_2
  00000048            00047         udp_checksum_1
  00000049            00048         udp_checksum_2 ; 8 bytes (42 bytes total)
                      00049 
  0000004A            00050         magic ; always 0xAB
  0000004B            00051         version
  0000004C            00052         eee
  0000004D            00053         sleep_1
  0000004E            00054         sleep_2
                      00055 
  0000004F            00056         spi_device_id
  00000050            00057         spi_out_length
  00000051            00058         spi_out_pointer
  00000052            00059         spi_out_1
  00000053            00060         spi_out_2
  00000054            00061         spi_out_3
  00000055            00062         spi_out_4
  00000056            00063         spi_out_5
  00000057            00064         spi_out_6
  00000058            00065         spi_out_7
  00000059            00066         spi_out_8
  0000005A            00067         spi_memory_dump
                      00068 
                      00069         ENDC
                      00070 
                      00071         INCLUDE "spi.inc"
0000                  00001 spi_init
0000   1283 1303      00002         BANKSEL PORTA ; BANK0
0002   1408           00003         BSF PORTD, 0
                      00004 
0003   1683 1303      00005         BANKSEL TRISA ; BANK1
0005   3040           00006         MOVLW 0x40
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0006   0094           00007         MOVWF SSPSTAT
0007   1283 1303      00008         BANKSEL PORTA ; BANK0
0009   3020           00009         MOVLW 0x20
000A   0094           00010         MOVWF SSPCON
                      00011 
000B   3000           00012         MOVLW 0x00
000C   00DA           00013         MOVWF spi_memory_dump ; disable memory dump on next packet
                      00014 
000D   0008           00015         RETURN
                      00016 
000E                  00017 spi_send
                      00018         ;; select device
000E   1283 1303      00019         BANKSEL PORTA ; BANK0
0010   1008           00020         BCF PORTD, 0
                      00021 
                      00022         ;; send the bytes
0011   3052           00023         MOVLW spi_out_1           ; seek to the first byte
0012   0084           00024         MOVWF FSR                 ; our pointer is "file select register"
0013                  00025 spi_send_loop
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0013   1394           00026         BCF SSPCON, 7             ; WCOL
0014   0800           00027         MOVF INDF, W              ; load the byte
0015   0093           00028         MOVWF SSPBUF              ; send the byte
                      00029 ;d      MOVF FSR, W
                      00030 ;d      MOVWF PORTB
                      00031 ;d      CALL wait3
0016   1683 1303      00032         BANKSEL TRISA ; BANK1
0018                  00033 spi_send_wait
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0018   1C14           00034         BTFSS SSPSTAT, BF
0019   2818           00035         GOTO spi_send_wait
001A   1283 1303      00036         BANKSEL PORTA ; BANK0
001C   0A84           00037         INCF FSR, F               ; increase the pointer
001D   0BD0           00038         DECFSZ spi_out_length, F  ; decrease the remaining byte counter
001E   2813           00039         GOTO spi_send_loop        ; go back if we have more bytes
                      00040 
                      00041         ; ;;;; memory dump option!
001F   1C5A           00042         BTFSS spi_memory_dump, 0
0020   2827           00043         GOTO spi_no_dump
0021   105A           00044         BCF spi_memory_dump, 0     ; disable further memory dumps (endless loop)
0022   3020           00045         MOVLW 0x20                 ; set the pointer to the first byte
0023   0084           00046         MOVWF FSR
0024   3060           00047         MOVLW 0x60                 ; whole BANK0 "General Purpose Registry" memory
0025   00D0           00048         MOVWF spi_out_length
                      00049 ;d      CALL led_blue_on
0026   2813           00050         GOTO spi_send_loop
                      00051 
0027                  00052 spi_no_dump
                      00053 ;d      CALL led_blue_off
                      00054 ;d      MOVLW 0x00
                      00055 ;d      MOVWF PORTB
                      00056 
                      00057         ;; deselect device
0027   1408           00058         BSF PORTD, 0
                      00059 ;d      CALL wait4
                      00060         
0028   0008           00061         RETURN
                      00062 
                      00063 
                      00072         INCLUDE "eth.inc"
0029                  00001 eth_init
0029   3001           00002         MOVLW 0x01 ; = eth
002A   00CF           00003         MOVWF spi_device_id
                      00004         
002B   20BF           00005         CALL wait
002C   20BF           00006         CALL wait
002D   20BF           00007         CALL wait
                      00008         ;; eth: system reset (see doc 6.0)
002E   30FF           00009         MOVLW 0xFF ; SC (reset)
002F   00D2           00010         MOVWF spi_out_1
                      00011 
0030   3001           00012         MOVLW 0x01 ; spi: how many byte outputs follow
0031   00D0           00013         MOVWF spi_out_length
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0032   200E           00014         CALL spi_send
                      00015 
0033   20BF           00016         CALL wait
0034   20BF           00017         CALL wait
0035   20BF           00018         CALL wait
                      00019 
                      00020 
                      00021         ;; eth: select BANK0
0036   30A0           00022         MOVLW 0xA0 ; BFC
0037   381F           00023         IORLW 0x1F ; ECON1 (1F)
0038   00D2           00024         MOVWF spi_out_1
0039   3003           00025         MOVLW 0x03 ; xxxxxx00
003A   00D3           00026         MOVWF spi_out_2
                      00027 
003B   3002           00028         MOVLW 0x02 ; spi: how many byte outputs follow
003C   00D0           00029         MOVWF spi_out_length
003D   200E           00030         CALL spi_send
                      00031 
                      00032 
                      00033         ;; eth: set receive buffer start and end pointers (see doc 6.1)
003E   3040           00034         MOVLW 0x40 ; WCR
003F   3808           00035         IORLW 0x08 ; ERXSTL
0040   00D2           00036         MOVWF spi_out_1
0041   3000           00037         MOVLW 0x00 ; ... ERXSTL
0042   00D3           00038         MOVWF spi_out_2
0043   3000           00039         MOVLW 0x00 ; ... ERXSTH
0044   00D4           00040         MOVWF spi_out_3
0045   30FF           00041         MOVLW 0xFF ; ... ERXNDL
0046   00D5           00042         MOVWF spi_out_4
0047   300F           00043         MOVLW 0x0F ; ... ERXNDH
0048   00D6           00044         MOVWF spi_out_5
                      00045         
0049   3005           00046         MOVLW 0x05 ;; spi: how many byte outputs follow
004A   00D0           00047         MOVWF spi_out_length
004B   200E           00048         CALL spi_send
                      00049 
                      00050 ;optimization...
                      00051 ;       ;; eth: select BANK2
                      00052 ;       MOVLW 0xA0 ; BFC
                      00053 ;       IORLW 0x1F ; ECON1 (1F)
                      00054 ;       MOVWF spi_out_1
                      00055 ;       MOVLW 0x03 ; xxxxxx00
                      00056 ;       MOVWF spi_out_2
                      00057 ;
                      00058 ;       MOVLW 0x02 ; spi: how many byte outputs follow
                      00059 ;       MOVWF spi_out_length
                      00060 ;       CALL spi_send
                      00061 
004C   3080           00062         MOVLW 0x80 ; BFS
004D   381F           00063         IORLW 0x1F ; ECON1
004E   00D2           00064         MOVWF spi_out_1
004F   3002           00065         MOVLW 0x02 ; xxxxxx1x => xxxxxx10
0050   00D3           00066         MOVWF spi_out_2
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00067 
0051   3002           00068         MOVLW 0x02 ; spi: how many byte outputs follow
0052   00D0           00069         MOVWF spi_out_length
0053   200E           00070         CALL spi_send
                      00071 
                      00072 
                      00073         ;; init MAC parameters (see doc 6.5)
0054   3040           00074         MOVLW 0x40 ; WCR
0055   3800           00075         IORLW 0x00 ; MACON1 (00)
0056   00D2           00076         MOVWF spi_out_1
0057   300D           00077         MOVLW 0x0D ; ... MACON1
0058   00D3           00078         MOVWF spi_out_2
0059   3000           00079         MOVLW 0x00 ; ... MACON2
005A   00D4           00080         MOVWF spi_out_3
005B   3077           00081         MOVLW 0x77 ; ... MACON3
005C   00D5           00082         MOVWF spi_out_4
005D   3003           00083         MOVLW 0x03 ; ... MACON4
005E   00D6           00084         MOVWF spi_out_5
005F   300F           00085         MOVLW 0x0F ; ... MABBIPG
0060   00D7           00086         MOVWF spi_out_6
                      00087         
0061   3006           00088         MOVLW 0x06 ;; spi: how many byte outputs follow
0062   00D0           00089         MOVWF spi_out_length
0063   200E           00090         CALL spi_send
                      00091 
                      00092         
                      00093         ;; init LEDs by writing the PHLCON register indirectly (see doc 2.6 and 3.3.2)
0064   3040           00094         MOVLW 0x40 ; WCR
0065   3814           00095         IORLW 0x14 ; MIREGADR (14)
0066   00D2           00096         MOVWF spi_out_1
0067   3014           00097         MOVLW 0x14 ; ... MIREGADR (14 = eth PHLCON)
0068   00D3           00098         MOVWF spi_out_2
0069   3000           00099         MOVLW 0x00 ; ... -
006A   00D4           00100         MOVWF spi_out_3
006B   3072           00101         MOVLW 0x72 ; ... MIWRL
006C   00D5           00102         MOVWF spi_out_4
006D   3004           00103         MOVLW 0x04 ; ... MIWRH
006E   00D6           00104         MOVWF spi_out_5
                      00105         
006F   3005           00106         MOVLW 0x05 ;; spi: how many byte outputs follow
0070   00D0           00107         MOVWF spi_out_length
0071   200E           00108         CALL spi_send
                      00109 
0072   0008           00110         RETURN
                      00111 
                      00112 ;;; test function to turn on both LEDs on eth
                      00113 ;eth_leds_on
                      00114 ;       BANKSEL PORTA ; BANK0
                      00115 ;
                      00116 ;       MOVLW 0x01 ; = eth
                      00117 ;       MOVWF spi_device_id
                      00118 ;
                      00119 ;       ;; eth select BANK2
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00120 ;       MOVLW 0xA0 ; BFC
                      00121 ;       IORLW 0x1F ; ECON1 (1F)
                      00122 ;       MOVWF spi_out_1
                      00123 ;       MOVLW 0x03
                      00124 ;       MOVWF spi_out_2
                      00125 ;
                      00126 ;       MOVLW 0x02 ; spi: how many byte outputs follow
                      00127 ;       MOVWF spi_out_length
                      00128 ;       CALL spi_send
                      00129 ;
                      00130 ;       MOVLW 0x80 ; BFS
                      00131 ;       IORLW 0x1F ; ECON1 (1F)
                      00132 ;       MOVWF spi_out_1
                      00133 ;       MOVLW 0x02
                      00134 ;       MOVWF spi_out_2
                      00135 ;
                      00136 ;       MOVLW 0x02 ; spi: how many byte outputs follow
                      00137 ;       MOVWF spi_out_length
                      00138 ;       CALL spi_send
                      00139 ;
                      00140 ;
                      00141 ;       MOVLW 0x40 ; WCR
                      00142 ;       IORLW 0x14 ; MIREGADR (14)
                      00143 ;       MOVWF spi_out_1
                      00144 ;       MOVLW 0x14 ; ... MIREGADR (14 = eth PHLCON)
                      00145 ;       MOVWF spi_out_2
                      00146 ;       MOVLW 0x00 ; ... -
                      00147 ;       MOVWF spi_out_3
                      00148 ;       MOVLW 0x82 ; ... MIWRL
                      00149 ;       MOVWF spi_out_4
                      00150 ;       MOVLW 0x08 ; ... MIWRH
                      00151 ;       MOVWF spi_out_5
                      00152 ;       
                      00153 ;       MOVLW 0x05 ;; spi: how many byte outputs follow
                      00154 ;       MOVWF spi_out_length
                      00155 ;       CALL spi_send
                      00156 ;
                      00157 ;       RETURN
                      00158 
0073                  00159 eth_send_packet
0073   1283 1303      00160         BANKSEL PORTA ; BANK0
                      00161 
                      00162         ;; eth: select BANK0
0075   30A0           00163         MOVLW 0xA0 ; BFC
0076   381F           00164         IORLW 0x1F ; ECON1 (1F)
0077   00D2           00165         MOVWF spi_out_1
0078   3003           00166         MOVLW 0x03 ; xxxxxx00
0079   00D3           00167         MOVWF spi_out_2
                      00168 
007A   3002           00169         MOVLW 0x02 ; spi: how many byte outputs follow
007B   00D0           00170         MOVWF spi_out_length
007C   200E           00171         CALL spi_send
                      00172 
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00173 
                      00174         ;; eth: set up ETXST (see doc 7.1.1)
007D   3040           00175         MOVLW 0x40 ; WCR
007E   3804           00176         IORLW 0x04 ; ETXSTL
007F   00D2           00177         MOVWF spi_out_1
0080   3000           00178         MOVLW 0x00 ; ... ETXSTL
0081   00D3           00179         MOVWF spi_out_2
0082   3010           00180         MOVLW 0x10 ; ... ETXSTH
0083   00D4           00181         MOVWF spi_out_3
                      00182         
0084   3003           00183         MOVLW 0x03 ;; spi: how many byte outputs follow
0085   00D0           00184         MOVWF spi_out_length
0086   200E           00185         CALL spi_send
                      00186 
                      00187 
                      00188         ;; eth: set up EWRPT (see doc 7.1.1)
0087   3040           00189         MOVLW 0x40 ; WCR
0088   3802           00190         IORLW 0x02 ; EWRPTL
0089   00D2           00191         MOVWF spi_out_1
008A   3000           00192         MOVLW 0x00 ; ... EWRPTL
008B   00D3           00193         MOVWF spi_out_2
008C   3010           00194         MOVLW 0x10 ; ... EWRPTH
008D   00D4           00195         MOVWF spi_out_3
                      00196         
008E   3003           00197         MOVLW 0x03 ;; spi: how many byte outputs follow
008F   00D0           00198         MOVWF spi_out_length
0090   200E           00199         CALL spi_send
                      00200 
                      00201 
                      00202         ;; eth: send the "per packet control byte" and the data payload (see doc 7.1.2)
                      00203         ;;      the payload is actually the whole memory :)
0091   3060           00204         MOVLW 0x60 ; WBM
0092   381A           00205         IORLW 0x1A ; required argument
0093   00D2           00206         MOVWF spi_out_1
0094   3000           00207         MOVLW 0x00 ; the "per packet control byte"
0095   00D3           00208         MOVWF spi_out_2
                      00209         
0096   145A           00210         BSF spi_memory_dump, 0 ; enable memory dump with next spi_send
                      00211 
0097   3002           00212         MOVLW 0x02 ;; spi: how many byte outputs follow (before the memory dump)
0098   00D0           00213         MOVWF spi_out_length
0099   200E           00214         CALL spi_send
                      00215         
                      00216 
                      00217         ;; eth: set up ETXND (see doc 7.1.3)
009A   3040           00218         MOVLW 0x40 ; WCR
009B   3806           00219         IORLW 0x06 ; ETXNDL
009C   00D2           00220         MOVWF spi_out_1
009D   3060           00221         MOVLW 0x60 ; ... ETXNDL
009E   00D3           00222         MOVWF spi_out_2
009F   3010           00223         MOVLW 0x10 ; ... ETXNDH
00A0   00D4           00224         MOVWF spi_out_3
                      00225         
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A1   3003           00226         MOVLW 0x03 ;; spi: how many byte outputs follow
00A2   00D0           00227         MOVWF spi_out_length
00A3   200E           00228         CALL spi_send
                      00229 
                      00230 
                      00231         ;; eth: clear EIR.TXIF (see doc 7.1.4)
00A4   30A0           00232         MOVLW 0xA0 ; BFC
00A5   381C           00233         IORLW 0x1C ; EIR
00A6   00D2           00234         MOVWF spi_out_1
00A7   3008           00235         MOVLW 0x08 ; .TXIF => 0
00A8   00D3           00236         MOVWF spi_out_2
                      00237         
00A9   3002           00238         MOVLW 0x02 ;; spi: how many byte outputs follow
00AA   00D0           00239         MOVWF spi_out_length
00AB   200E           00240         CALL spi_send
                      00241 
                      00242 
                      00243         ;; eth: set EIE.TXIE (see doc 7.1.4)
00AC   3080           00244         MOVLW 0x80 ; BFS
00AD   381B           00245         IORLW 0x1B ; EIE
00AE   00D2           00246         MOVWF spi_out_1
00AF   3080           00247         MOVLW 0x80 ; .TXIF => 0
00B0   00D3           00248         MOVWF spi_out_2
                      00249         
00B1   3002           00250         MOVLW 0x02 ;; spi: how many byte outputs follow
00B2   00D0           00251         MOVWF spi_out_length
00B3   200E           00252         CALL spi_send
                      00253 
                      00254 
                      00255         ;; eth: set ECON1.TXRTS (see doc 7.1.5)
00B4   3080           00256         MOVLW 0x80 ; BFS
00B5   381F           00257         IORLW 0x1F ; ECON1
00B6   00D2           00258         MOVWF spi_out_1
00B7   3008           00259         MOVLW 0x08 ; .TXRTS => 1
00B8   00D3           00260         MOVWF spi_out_2
                      00261         
00B9   3002           00262         MOVLW 0x02 ;; spi: how many outputs follow
00BA   00D0           00263         MOVWF spi_out_length
00BB   200E           00264         CALL spi_send
                      00265 
                      00266         
00BC   0008           00267         RETURN
                      00073 
                      00074 ;       ORG 0x000 ; start at the reset vector
00BD   0000           00075         nop
                      00076 
00BE   2951           00077         GOTO main ; start the program
                      00078 
00BF                  00079 wait
00BF   30FF           00080         MOVLW 0xFF
00C0   00CE           00081         MOVWF sleep_2
00C1   30FF           00082         MOVLW 0xFF
00C2   00CD           00083         MOVWF sleep_1
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00C3                  00084 wloop
00C3   0BCD           00085         DECFSZ sleep_1, F
00C4   28C3           00086         GOTO wloop
00C5   0BCE           00087         DECFSZ sleep_2, F
00C6   28C3           00088         GOTO wloop
00C7   0008           00089         RETURN
                      00090 
00C8                  00091 init_vars
00C8   30F4           00092         MOVLW 0xf4
00C9   00A0           00093         MOVWF mac_dest_1
00CA   306D           00094         MOVLW 0x6d
00CB   00A1           00095         MOVWF mac_dest_2
00CC   3004           00096         MOVLW 0x04
00CD   00A2           00097         MOVWF mac_dest_3
00CE   30E7           00098         MOVLW 0xe7
00CF   00A3           00099         MOVWF mac_dest_4
00D0   30B2           00100         MOVLW 0xb2
00D1   00A4           00101         MOVWF mac_dest_5
00D2   3034           00102         MOVLW 0x34
00D3   00A5           00103         MOVWF mac_dest_6
00D4   30E0           00104         MOVLW 0xE0
00D5   00A6           00105         MOVWF mac_src_1
00D6   30CB           00106         MOVLW 0xCB
00D7   00A7           00107         MOVWF mac_src_2
00D8   304E           00108         MOVLW 0x4E
00D9   00A8           00109         MOVWF mac_src_3
00DA   305E           00110         MOVLW 0x5E
00DB   00A9           00111         MOVWF mac_src_4    ; <<<
00DC   3087           00112         MOVLW 0x87
00DD   00AA           00113         MOVWF mac_src_5    ; <<<
00DE   308E           00114         MOVLW 0x8E
00DF   00AB           00115         MOVWF mac_src_6    ; <<<
00E0   3008           00116         MOVLW 0x08
00E1   00AC           00117         MOVWF mac_type_1
00E2   3000           00118         MOVLW 0x00
00E3   00AD           00119         MOVWF mac_type_2
                      00120 
00E4   3045           00121         MOVLW 0x45
00E5   00AE           00122         MOVWF ip_version_and_header_length
00E6   3000           00123         MOVLW 0x00
00E7   00AF           00124         MOVWF ip_dummy
00E8   3000           00125         MOVLW 0x00
00E9   00B0           00126         MOVWF ip_length_1    ; <<<
00EA   3052           00127         MOVLW 0x52
00EB   00B1           00128         MOVWF ip_length_2    ; <<< (including IP and UDP header)
00EC   3000           00129         MOVLW 0x00
00ED   00B2           00130         MOVWF ip_packet_id_1 ; <<<
00EE   3000           00131         MOVLW 0x00
00EF   00B3           00132         MOVWF ip_packet_id_2 ; <<< increment this before transmit
00F0   3040           00133         MOVLW 0x40
00F1   00B4           00134         MOVWF ip_flags_1
00F2   3000           00135         MOVLW 0x00
00F3   00B5           00136         MOVWF ip_flags_2
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00F4   3040           00137         MOVLW 0x40
00F5   00B6           00138         MOVWF ip_ttl
00F6   3011           00139         MOVLW 0x11
00F7   00B7           00140         MOVWF ip_protocol
00F8   30B8           00141         MOVLW 0xB8
00F9   00B8           00142         MOVWF ip_header_checksum_1    ; <<<
00FA   3075           00143         MOVLW 0x75
00FB   00B9           00144         MOVWF ip_header_checksum_2    ; <<<
00FC   30C0           00145         MOVLW 0xC0
00FD   00BA           00146         MOVWF ip_src_1
00FE   30A8           00147         MOVLW 0xA8
00FF   00BB           00148         MOVWF ip_src_2
0100   3000           00149         MOVLW 0x00
0101   00BC           00150         MOVWF ip_src_3
0102   30C9           00151         MOVLW 0xC9
0103   00BD           00152         MOVWF ip_src_4
0104   30C0           00153         MOVLW 0xC0
0105   00BE           00154         MOVWF ip_dest_1
0106   30A8           00155         MOVLW 0xA8
0107   00BF           00156         MOVWF ip_dest_2
0108   3000           00157         MOVLW 0x00
0109   00C0           00158         MOVWF ip_dest_3
010A   300C           00159         MOVLW 0x0C
010B   00C1           00160         MOVWF ip_dest_4
                      00161 
010C   3018           00162         MOVLW 0x18
010D   00C2           00163         MOVWF udp_src_port_1
010E   30F7           00164         MOVLW 0xF7
010F   00C3           00165         MOVWF udp_src_port_2
0110   3018           00166         MOVLW 0x18
0111   00C4           00167         MOVWF udp_dest_port_1
0112   30F8           00168         MOVLW 0xF8
0113   00C5           00169         MOVWF udp_dest_port_2
0114   3000           00170         MOVLW 0x00
0115   00C6           00171         MOVWF udp_length_1    ; <<<
0116   3009           00172         MOVLW 0x09
0117   00C7           00173         MOVWF udp_length_2    ; <<< (including UDP header)
0118   3000           00174         MOVLW 0x00           
0119   00C8           00175         MOVWF udp_checksum_1  ; ignore
011A   3000           00176         MOVLW 0x00
011B   00C9           00177         MOVWF udp_checksum_2  ; ignore
                      00178 
011C   3065           00179         MOVLW 0x65 ; "e"
011D   00CA           00180         MOVWF magic
                      00181 
011E   3001           00182         MOVLW 0x01
011F   00CB           00183         MOVWF version
0120   0008           00184         RETURN
                      00185 
                      00186 
0121                  00187 init
0121   1683 1303      00188         BANKSEL TRISA  ; BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0123   0185           00189         CLRF TRISA     ; set all bits on PORTA to output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0124   0186           00190         CLRF TRISB     ; set all bits on PORTB to output
                      00191         ;;CLRF TRISC     ; set all bits on PORTC to output
0125   3010           00192         MOVLW b'00010000'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0126   0087           00193         MOVWF TRISC
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0127   0188           00194         CLRF TRISD     ; set all bits on PORTD to output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0128   0189           00195         CLRF TRISE     ; set all bits on PORTE to output
                      00196 
0129   1283 1303      00197         BANKSEL PORTA  ; BANK0
012B   0185           00198         CLRF PORTA
012C   0186           00199         CLRF PORTB
012D   0187           00200         CLRF PORTC
012E   0188           00201         CLRF PORTD
012F   0189           00202         CLRF PORTE
                      00203 
0130   2139           00204         CALL led_red_on
                      00205 
0131   20C8           00206         CALL init_vars
0132   2000           00207         CALL spi_init
0133   2029           00208         CALL eth_init
                      00209 ;       CALL eth_leds_on
                      00210 
0134   213D           00211         CALL led_red_off
0135   2141           00212         CALL led_green_on
                      00213 
0136   0008           00214         RETURN
                      00215 
0137                  00216 measure_input_1
0137   0008           00217         RETURN
                      00218 
0138                  00219 measure_input_2
0138   0008           00220         RETURN
                      00221 
0139                  00222 led_red_on
0139   1283 1303      00223         BANKSEL PORTA ; BANK0
013B   1406           00224         BSF PORTB, 0
013C   0008           00225         RETURN
                      00226 
013D                  00227 led_red_off
013D   1283 1303      00228         BANKSEL PORTA ; BANK0
013F   1006           00229         BCF PORTB, 0
0140   0008           00230         RETURN
                      00231 
0141                  00232 led_green_on
0141   1283 1303      00233         BANKSEL PORTA ; BANK0
0143   1506           00234         BSF PORTB, 2
0144   0008           00235         RETURN
                      00236 
0145                  00237 led_green_off
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0145   1283 1303      00238         BANKSEL PORTA ; BANK0
0147   1106           00239         BCF PORTB, 2
0148   0008           00240         RETURN
                      00241 
0149                  00242 led_blue_on
0149   1283 1303      00243         BANKSEL PORTA ; BANK0
014B   1486           00244         BSF PORTB, 1
014C   0008           00245         RETURN
                      00246 
014D                  00247 led_blue_off
014D   1283 1303      00248         BANKSEL PORTA ; BANK0
014F   1086           00249         BCF PORTB, 1
0150   0008           00250         RETURN
                      00251         
0151                  00252 main
0151   2121           00253         CALL init
                      00254         
0152                  00255 loop
                      00256 
0152   2145           00257         CALL led_green_off
0153   2139           00258         CALL led_red_on
0154   20BF           00259         CALL wait
0155   3000           00260         MOVLW 0x00
0156   1988           00261         BTFSC PORTD, 3
0157   30FF           00262         MOVLW 0xFF
0158   00CC           00263         MOVWF eee
0159   2073           00264         CALL eth_send_packet
015A   213D           00265         CALL led_red_off
015B   2141           00266         CALL led_green_on
015C   20BF           00267         CALL wait
015D   20BF           00268         CALL wait
015E   20BF           00269         CALL wait
015F   20BF           00270         CALL wait
0160   20BF           00271         CALL wait
0161   20BF           00272         CALL wait
0162   20BF           00273         CALL wait
0163   20BF           00274         CALL wait
0164   20BF           00275         CALL wait
0165   20BF           00276         CALL wait
0166   20BF           00277         CALL wait
0167   2952           00278         GOTO loop
                      00279         END
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 13


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
D_A                               00000005
D_NOT_A                           00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GO_NOT_DONE                       00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
NOT_A                             00000005
NOT_ADDRESS                       00000005
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SEN                               00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_HS_OSC                           00003FFE
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001
eee                               0000004C
eth_init                          00000029
eth_send_packet                   00000073
init                              00000121
init_vars                         000000C8
ip_dest_1                         0000003E
ip_dest_2                         0000003F
ip_dest_3                         00000040
ip_dest_4                         00000041
ip_dummy                          0000002F
ip_flags_1                        00000034
ip_flags_2                        00000035
ip_header_checksum_1              00000038
ip_header_checksum_2              00000039
ip_length_1                       00000030
ip_length_2                       00000031
ip_packet_id_1                    00000032
ip_packet_id_2                    00000033
ip_protocol                       00000037
ip_src_1                          0000003A
ip_src_2                          0000003B
ip_src_3                          0000003C
ip_src_4                          0000003D
ip_ttl                            00000036
ip_version_and_header_length      0000002E
led_blue_off                      0000014D
led_blue_on                       00000149
led_green_off                     00000145
led_green_on                      00000141
led_red_off                       0000013D
led_red_on                        00000139
loop                              00000152
mac_dest_1                        00000020
mac_dest_2                        00000021
mac_dest_3                        00000022
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

mac_dest_4                        00000023
mac_dest_5                        00000024
mac_dest_6                        00000025
mac_src_1                         00000026
mac_src_2                         00000027
mac_src_3                         00000028
mac_src_4                         00000029
mac_src_5                         0000002A
mac_src_6                         0000002B
mac_type_1                        0000002C
mac_type_2                        0000002D
magic                             0000004A
main                              00000151
measure_input_1                   00000137
measure_input_2                   00000138
sleep_1                           0000004D
sleep_2                           0000004E
spi_device_id                     0000004F
spi_init                          00000000
spi_memory_dump                   0000005A
spi_no_dump                       00000027
spi_out_1                         00000052
spi_out_2                         00000053
spi_out_3                         00000054
spi_out_4                         00000055
spi_out_5                         00000056
spi_out_6                         00000057
spi_out_7                         00000058
spi_out_8                         00000059
spi_out_length                    00000050
spi_out_pointer                   00000051
spi_send                          0000000E
spi_send_loop                     00000013
spi_send_wait                     00000018
udp_checksum_1                    00000048
udp_checksum_2                    00000049
udp_dest_port_1                   00000044
udp_dest_port_2                   00000045
udp_length_1                      00000046
udp_length_2                      00000047
udp_src_port_1                    00000042
udp_src_port_2                    00000043
version                           0000004B
wait                              000000BF
wloop                             000000C3
MPASM  5.42                       PROG1_2.ASM   3-5-2012  20:03:27         PAGE 21


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXX-------- ----------------

All other memory blocks unused.

Program Memory Words Used:   360
Program Memory Words Free:  7832


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     7 reported,     0 suppressed

